# å®šä½ç‰ˆæœ¬é—®é¢˜ç¥å™¨-é¡¹ç›®ç‰ˆæœ¬ä¿¡æ¯æ’ä»¶(webpack æ’ä»¶å’Œ vite æ’ä»¶)

> ä¸€ä¸ªé¡¹ç›®å®ç”¨çš„å·¥å…·ç±»æ’ä»¶ï¼Œåˆ†åˆ«æä¾›äº† **_webpack æ’ä»¶_** ç‰ˆæœ¬å’Œ **_vite æ’ä»¶_**ç‰ˆæœ¬ã€‚æ‰“åŒ…é¡¹ç›®æ—¶è‡ªåŠ¨æ³¨å…¥é¡¹ç›®æ‰“åŒ…ä¿¡æ¯ï¼Œå¯åœ¨æ§åˆ¶å°æ—¥å¿—æŸ¥çœ‹ï¼Œæ–¹ä¾¿å®šä½ç‰ˆæœ¬é—®é¢˜ã€‚é¡¹ç›®æ‰“åŒ…ä¿¡æ¯åŒ…æ‹¬ï¼šgit ä»“åº“ä¿¡æ¯ã€æ‰“åŒ…æ—¶é—´å’Œç”¨æˆ·æŒ‡å®šçš„ä»»æ„ä¿¡æ¯ã€‚

ğŸ˜ˆ å‰æï¼š åœ¨æ‰“åŒ…å·¥å…·çš„é…ç½®æ–‡ä»¶ä¸­å¼•å…¥ä½¿ç”¨æ’ä»¶ï¼Œæ‰“åŒ…é¡¹ç›®æ—¶(`npm run build`)ï¼Œæ’ä»¶ä¼šè‡ªåŠ¨å°†é¡¹ç›®ç‰ˆæœ¬ä¿¡æ¯çš„ä»£ç é€šè¿‡ scirpt æ ‡ç­¾åŠ¨æ€æ³¨å…¥åˆ°æ‰“åŒ…äº§ç‰©çš„ html ä¸­ã€‚æ‰€ä»¥ä¹Ÿè¦æ±‚ä¸šåŠ¡ä»£ç çš„æ‰“åŒ…äº§ç‰©æ˜¯æœ‰ html æ–‡ä»¶çš„ã€‚ï¼ˆä¸šåŠ¡é¡¹ç›®éƒ½æœ‰å§ ğŸ˜ã€‚ã€‚ã€‚ï¼‰

## inject-project-info æ’ä»¶

- é¡¹ç›® github åœ°å€ï¼šhttps://github.com/Damon0820/inject-project-info

## ä½¿ç”¨åœºæ™¯

æ˜¯å¦å¤§å®¶é‡åˆ°è¿‡ç±»ä¼¼çš„é—®é¢˜ï¼šæŸå¤©æµ‹è¯•æäº†ä¸€äº› bug ç»™å¼€å‘äººå‘˜ Aï¼Œå¼€å‘äººå‘˜ A è¡¨ç¤ºè¿™äº› bug å·²ç»ä¿®å¤å¹¶è‡ªæµ‹å‘ç‰ˆäº†ï¼Œæœ¬ä¸åº”è¯¥åœ¨çº¿ä¸Šå‡ºç°è¿™äº› bugï¼Œå¯¹æ­¤æ„Ÿåˆ°ç–‘æƒ‘ã€‚å¯èƒ½çš„åŸå› æœ‰ï¼š

1. æµ‹è¯•æœ¬åœ°æœ‰ç¼“å­˜æˆ–è€…ç‰ˆæœ¬æ›´æ–°æœºåˆ¶å‡ºé—®é¢˜ç­‰å…¶ä»–åŸå› ï¼Œä¸æ˜¯æœ€æ–°ç‰ˆæœ¬ã€‚
2. æµ‹è¯•æœ¬åœ°æ˜¯æœ€æ–°ç‰ˆï¼Œå¼€å‘äººå‘˜ A è®°é”™äº†ï¼Œæ”¹äº† bug ä½†æ˜¯å¿˜è®°å‘ç‰ˆã€‚
3. æµ‹è¯•æœ¬åœ°æ˜¯æœ€æ–°ç‰ˆï¼Œå¼€å‘äººå‘˜ A ä¹Ÿä¿®å¤äº† bug å¹¶å‘è¿‡ç‰ˆæœ¬ã€‚ä½†æ˜¯å¼€å‘äººå‘˜ B æœªæ‹‰å–å¼€å‘äººå‘˜ A æäº¤çš„ä»£ç ï¼ˆæˆ–å¼€å‘äººå‘˜ A ä»£ç æœªæ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼‰ï¼Œç›´æ¥å‘äº†ä¸€ä¸ªæ›´æ–°çš„ç‰ˆæœ¬ï¼Œè¦†ç›–äº†å¼€å‘äººå‘˜ A å‘çš„ç‰ˆæœ¬ã€‚
4. ç­‰ç­‰å…¶ä»–åŸå› ã€‚ã€‚ã€‚

è¿™ä¸ªåŸå› å…¶å®æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªé—®é¢˜-**ç‰ˆæœ¬é—®é¢˜**ã€‚åŸå›  1 æ˜¯æœªæ›´æ–°åˆ°æœ€æ–°ç‰ˆå¯¼è‡´çš„ã€‚åŸå›  2 å¿˜è®°å‘ç‰ˆï¼Œçº¿ä¸Šç‰ˆæœ¬ä¸æ˜¯é¢„æœŸçš„æœ€æ–°ç‰ˆæœ¬ã€‚ åŸå›  3 æ¯”è¾ƒéšè”½ï¼Œè™½ç„¶æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œä½†æ˜¯ç‰ˆæœ¬ä»£ç æœªåŒæ­¥æ›´æ–°åˆ°å…¶ä»–äººçš„ä»£ç å¯¼è‡´çš„ã€‚ç‰ˆæœ¬ä»£ç ä¸æ˜¯é¢„æœŸã€‚
é‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ä¸ªæ¯”è¾ƒå¿«é€Ÿå’Œæ–¹ä¾¿çš„æ–¹æ³•å»å®šä½è¿™ä¸ªç‰ˆæœ¬é—®é¢˜ã€‚inject-project-info æ’ä»¶æä¾›äº†ä¸€ç§æ–¹æ³•ï¼Œè®°å½•å½“å‰ç‰ˆæœ¬æ‰“åŒ…çš„æ—¶é—´å’Œ git ä»“åº“æœ€è¿‘ä¸€æ¬¡æäº¤è®°å½•ç­‰ä¿¡æ¯è¾…åŠ©æˆ‘ä»¬å»å®šä½ç‰ˆæœ¬é—®é¢˜ã€‚

é¦–å…ˆï¼Œå‰ææ˜¯å‘ç‰ˆäººå‘˜è®°å¾—è‡ªå·±æ‰“åŒ…é¡¹ç›®ï¼ˆæ‰§è¡Œ`npm run build`ï¼‰çš„æ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´è®°å½•åˆ° Build Date ä¸­ã€‚ä½œä¸ºå½“å‰ç‰ˆæœ¬çš„æ ‡å¿—ä¿¡æ¯ã€‚æ¢å¥è¯è¯´ï¼Œæ‰“åŒ…æ—¶é—´çº¦ç­‰äºç‰ˆæœ¬æ ‡è¯†ã€‚é‚£ä¹ˆé‡åˆ°ä¸Šè¿°é—®é¢˜ï¼Œå¯ä»¥è¿™ä¹ˆå®šä½ï¼š

1. æ¯”å¯¹æµ‹è¯•æœ¬åœ°çš„æ‰“åŒ…æ—¶é—´å’Œå¼€å‘äººå‘˜ A æœ¬åœ°ç‰ˆæœ¬çš„æ‰“åŒ…æ—¶é—´ï¼Œå‡å¦‚ä¸ä¸€è‡´ï¼Œä¸”æµ‹è¯•çš„æ—¶é—´æ›´æ—©ï¼Œè¯´æ˜æµ‹è¯•æœ¬åœ°ä¸æ˜¯æœ€æ–°ç‰ˆï¼Œéœ€è¦åˆ·æ–°æˆ–è€…æ¸…ç¼“å­˜ç­‰æ‰‹æ®µï¼Œå‡çº§åˆ°æœ€æ–°ç‰ˆã€‚
1. å¼€å‘äººå‘˜ A æœ¬åœ°ç‰ˆæœ¬çš„æ‰“åŒ…æ—¶é—´å’Œæµ‹è¯•æœ¬åœ°æ‰“åŒ…æ—¶é—´ä¸€è‡´ï¼Œå¹¶ä¸”æ‰“åŒ…æ—¶é—´æ—©äºå¼€å‘äººå‘˜ A æ”¹ bug çš„æ—¶é—´ï¼Œè¯´æ˜å¼€å‘äººå‘˜è®°é”™äº†ï¼Œæ”¹å®Œ bug æœªå‘ç‰ˆ
1. å¼€å‘äººå‘˜ A æœ¬åœ°ç‰ˆæœ¬çš„æ‰“åŒ…æ—¶é—´å’Œæµ‹è¯•æœ¬åœ°æ‰“åŒ…æ—¶é—´ä¸€è‡´ï¼Œå¹¶ä¸”æ‰“åŒ…æ—¶é—´æ™šäºå¼€å‘äººå‘˜ A è®°å¿†ä¸­çš„å‘ç‰ˆæ—¶é—´ï¼Œè¯´æ˜æœ‰å¼€å‘äººå‘˜ B åœ¨å¼€å‘äººå‘˜ A ä¹‹åå‘ç‰ˆï¼Œå¹¶ä¸”æœªåŒæ­¥åˆ°å¼€å‘äººå‘˜ A çš„ä»£ç ã€‚
1. ç­‰ç­‰å…¶ä»–åœºæ™¯ã€‚ã€‚ã€‚

ä»¥ä¸Šåˆ—ä¸¾äº†ä¸€äº›åœºæ™¯ï¼Œæ‰“åŒ…ä¿¡æ¯çš„æ‰“åŒ…æ—¶é—´ä¿¡æ¯ç»™äº†å¼ºæœ‰åŠ›çš„æ–¹å‘æŒ‡å¼•ï¼Œå»å®šä½å¯èƒ½å‡ºç°ç‰ˆæœ¬é—®é¢˜çš„åŸå› ã€‚è¿™ä¹Ÿæ˜¯é¡¹ç›®æ‰“åŒ…ä¿¡æ¯å¸¦ç»™æˆ‘ä»¬çš„æ”¶ç›Šä¹‹ä¸€ï¼Œç»å¸¸èƒ½è¾…åŠ©æˆ‘ä»¬å¿«é€Ÿå®šä½ç‰ˆæœ¬é—®é¢˜ï¼Œå‡å°‘ç–‘æƒ‘ï¼Œå‘ç°å…·ä½“åŸå› ï¼Œè¿›è€Œè§„é¿å‡å°‘ç‰ˆæœ¬é—®é¢˜å‡ºç°ã€‚
æ’ä»¶é™¤äº†é¢„ç½®æ‰“å°æ‰“åŒ…æ—¶é—´ï¼Œè¿˜é¢„ç½®æ‰“å°äº† git é¡¹ç›®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ git é¡¹ç›®åç§°ï¼Œåˆ†æ”¯åç§°ï¼Œæœ€è¿‘ä¸€æ¬¡æäº¤è®°å½•ä¿¡æ¯ã€‚git é¡¹ç›®ä¿¡æ¯ä¹Ÿå¯ä»¥å®šä½ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚çº¿ä¸Šç‰ˆæœ¬çš„ä»£ç æ¥è‡ªå“ªä¸ªåˆ†æ”¯ï¼Œä»£ç æœ€æ–°æäº¤æ˜¯ä»€ä¹ˆæ—¶å€™ã€‚é™¤äº†é¢„ç½®ä¿¡æ¯å¤–ï¼Œ
æ’ä»¶è¿˜æ”¯æŒæ‰“å°ç”¨æˆ·ä¼ å…¥è‡ªå®šä¹‰ä¿¡æ¯ï¼Œæ¯”å¦‚å¯ä»¥æ‰“å°é¡¹ç›® package.json çš„ç‰ˆæœ¬ version ç­‰ã€‚

## æ’ä»¶ä»‹ç»

> æ›´å¤šè¯¦ç»†ç”¨æ³•å’Œä»‹ç»ä¹Ÿå¯å‚è§[æ–‡æ¡£](https://github.com/Damon0820/inject-project-info)

## INSTALL

```js
 // npm
 npm i inject-project-info -D
 // pnpm
 pnpm add inject-project-info -D
```

## USAGE

> ç»“åˆæ‰“åŒ…å·¥å…· webpack å’Œ vite ä½¿ç”¨ï¼Œåˆ†åˆ«æä¾›å¯¹åº”çš„æ’ä»¶ã€‚

```ts
export interface Options {
  isLog?: boolean;
  timeout?: boolean | number;
  isLogLastCommitMessage?: boolean;
  extraLogInfo?: IExtraLogInfo[];
}

export interface IExtraLogInfo {
    label: string;
    value: string;
}

// webpack plugin
new InjectProjectInfoWebpackPlugin(options: Options),
// vite plugin
injectProjectInfoVitePlugin(options: Options),

```

### 1. ç»“åˆ webpack ä½¿ç”¨

#### 1.1. webpack æ„å»ºçš„é¡¹ç›®ä½¿ç”¨ç¤ºä¾‹ï¼š

```js
// webpack.config.js (webpacké…ç½®æ–‡ä»¶)

const InjectProjectInfoWebpackPlugin = require('inject-project-info/webpack');

module.exports = {
  // ...å…¶ä»–é…ç½®
  plugins: [
    new InjectProjectInfoWebpackPlugin({
      isLog: process.env.NODE_ENV !== 'development', // åªåœ¨ç”Ÿäº§æ¨¡å¼æ³¨å…¥é¡¹ç›®ä¿¡æ¯
    }),
  ],
};
```

#### 1.2. vue-cli åˆ›å»ºçš„é¡¹ç›®ï¼ˆåº•å±‚ä¹Ÿæ˜¯åŸºäº webpack æ„å»ºå·¥å…·ï¼‰ä½¿ç”¨ç¤ºä¾‹ï¼š

```js
// vue.config.js (é…ç½®æ–‡ä»¶)

const InjectProjectInfoWebpackPlugin = require("inject-project-info/webpack");

module.exports = {
  // ...å…¶ä»–é…ç½®
  configureWebpack: () => {
    new InjectProjectInfoWebpackPlugin({
      isLog: process.env.NODE_ENV !== "development", // åªåœ¨ç”Ÿäº§æ¨¡å¼æ³¨å…¥é¡¹ç›®ä¿¡æ¯
    }),
  },
};
```

#### 2. ç»“åˆ vite ä½¿ç”¨

#### vite æ„å»ºçš„é¡¹ç›®ä½¿ç”¨ç¤ºä¾‹ï¼š

```js
// vite.config.js (viteé…ç½®æ–‡ä»¶)

import { defineConfig } from 'vite';
import injectProjectInfoVitePlugin from 'inject-project-info/vite';

export default defineConfig({
  // ...å…¶ä»–é…ç½®
  plugins: [
    injectProjectInfoVitePlugin({
      isLog: !process.argv.includes('development'), // åªåœ¨ç”Ÿäº§æ¨¡å¼æ³¨å…¥é¡¹ç›®ä¿¡æ¯ã€‚
    }),
  ],
});
```

ç‰¹åˆ«è¯´æ˜ï¼šå› ä¸º vite é¡¹ç›®åœ¨ vite.config.js è·å– process.env.NODE_ENV ä¸º undefinedï¼Œéœ€è¦ä½¿ç”¨å…¶ä»–æ–¹æ³•åˆ¤æ–­æ˜¯å¦æ˜¯ç”Ÿäº§ç¯å¢ƒã€‚
å¯ä½¿ç”¨ cross-env å®šä¹‰ç¯å¢ƒå˜é‡ï¼Œæˆ–æ›´ç®€å•ç‚¹ï¼Œåœ¨ package.json çš„ç”Ÿäº§æ„å»ºå‘½ä»¤ï¼Œå¿…é¡»æ˜¾ç¤ºæŒ‡å®š--mode prodution å‚æ•°ï¼Œåˆ™ä½¿ç”¨ process.argv.includes('production')åˆ¤æ–­æ˜¯å¦æ˜¯ç”Ÿäº§ç¯å¢ƒã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š

```json
// package.jsonç¤ºä¾‹
{
  "scripts": {
    "dev": "vite --mode development",
    "build": "vue-tsc && vite build --mode production",
    "preview": "vite preview"
  }
}
```

## å‚æ•°è¯´æ˜

### options

| å‚æ•°åç§°               |                                                                                             è¯´æ˜ |              ç±»å‹ | é»˜è®¤å€¼ |
| :--------------------- | -----------------------------------------------------------------------------------------------: | ----------------: | -----: |
| isLog                  |               æ§åˆ¶æ’ä»¶æ˜¯å¦æ³¨å…¥é¡¹ç›®æ‰“åŒ…ä¿¡æ¯ï¼Œå¹¶æ‰“å°åˆ°æ§åˆ¶å°ã€‚<br>æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒå¼€å¯ï¼Œå¼€å‘ç¯å¢ƒå…³é—­ |           boolean |   true |
| timeout                |                        æ§åˆ¶æ§åˆ¶å°æ˜¯å¦å»¶è¿Ÿæ‰“å°æ‰“åŒ…ä¿¡æ¯ã€‚ä¼  false å¯å…³é—­ï¼Œä¼ æ•°å€¼è®¾ç½®å»¶è¿Ÿ x(ms)æ‰“å° | boolean æˆ– number |   2000 |
| isLogLastCommitMessage |                                  æ˜¯å¦æ‰“å°æœ€æ–°æäº¤è®°å½•çš„ commit messageã€‚è€ƒè™‘ä¿¡æ¯æ•æ„ŸåŸå› å»ºè®®å…³é—­ |           boolean |  false |
| extraLogInfo           | ç”¨æˆ·é¢å¤–æŒ‡å®šçš„æ‰“å°ä¿¡æ¯ã€‚æ¯”å¦‚æœ‰ç»´æŠ¤ package.json çš„ç‰ˆæœ¬å·çš„é¡¹ç›®ï¼Œå¯æ‰“å°å½“å‰ package.json çš„ç‰ˆæœ¬å· |   IExtraLogInfo[] |     [] |

### extraLogInfo

| å‚æ•°åç§° |         è¯´æ˜ |   ç±»å‹ | é»˜è®¤å€¼ |
| :------- | -----------: | -----: | -----: |
| label    | ä¿¡æ¯å·¦è¾¹æ ‡é¢˜ | string |     '' |
| value    | ä¿¡æ¯å³è¾¹å†…å®¹ | string |     '' |

## æ•ˆæœ

åŒ…æ‹¬ä»¥ä¸‹ä¿¡æ¯ï¼š

- é¡¹ç›®åç§° -> git åˆ†æ”¯
- æœ€è¿‘ä¸€æ¬¡æäº¤è®°å½•ï¼šæäº¤äºº -> æäº¤æ—¶é—´ï¼ˆcommit message å¯èƒ½ä¸ºæ•æ„Ÿä¿¡æ¯ä¸å»ºè®®ä¸å±•ç¤ºï¼‰ã€‚
- æ‰“åŒ…æ—¶é—´
- ç”¨æˆ·é¢å¤–æŒ‡å®šçš„æ‰“å°ä¿¡æ¯

ä¸‹æ–¹ä»£ç ç¤ºä¾‹åŠå…¶å¯¹åº”çš„æ•ˆæœå›¾å±•ç¤ºå¦‚ä¸‹ï¼š

```js
new InjectProjectInfoWebpackPlugin({
  timeout: 3000, // å»¶è¿Ÿ3sæ‰“å°
  isLog: process.env.NODE_ENV !== "development", // åªåœ¨å¼€å‘ç¯å¢ƒå¼€å¯
  // isLogLastCommitMessage: true,
  extraLogInfo: [ // ç”¨æˆ·é¢å¤–æŒ‡å®šçš„æ‰“å°ä¿¡æ¯
    {
      label: "Version",
      value: require("./package.json").version,
    },
    {
      label: "å…¶ä»–ä¿¡æ¯",
      value: "éœ€è¦æ‰“å°ä»€ä¹ˆå°±æ‰“å°ä»€ä¹ˆ",
    },
  ],
}),
```

<img src="./assets/inject-show.jpeg" style="width: 400px; display: block;">

## Todos

1. å†…ç½®å®ç°æ‰“å°é¡¹ç›®æ„å»ºä¾èµ–å®é™…ç‰ˆæœ¬ã€‚
2. commit ä¿¡æ¯æ‰“å° commit hash
